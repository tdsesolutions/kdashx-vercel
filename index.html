<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K-DashX - Command Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; }
        body { background: #0a0a0f; color: #e2e8f0; margin: 0; font-family: system-ui, -apple-system, sans-serif; overflow-x: hidden; }
        .glass-card { background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05)); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; }
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; } }
        .nav-item { background: transparent; border: none; width: 100%; text-align: left; padding: 0.75rem 1rem; display: flex; align-items: center; gap: 0.75rem; border-radius: 0.5rem; cursor: pointer; font-size: 0.875rem; }
        .nav-item:hover { background: rgba(255,255,255,0.05); }
        .nav-item.active { background: rgba(59,130,246,0.2); border: 1px solid rgba(59,130,246,0.3); color: #60a5fa; }
        input, textarea { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: white; padding: 0.75rem; border-radius: 0.5rem; width: 100%; font-size: 16px; font-family: inherit; }
        input:focus, textarea:focus { outline: none; border-color: rgba(59,130,246,0.5); }
        button { transition: all 0.2s; cursor: pointer; border: none; font-family: inherit; }
        .bottom-nav { display: none; }
        @media (max-width: 1023px) { 
            .desktop-sidebar { display: none; } 
            .bottom-nav { display: flex !important; position: fixed; bottom: 0; left: 0; right: 0; z-index: 50; background: rgba(10,10,15,0.95); border-top: 1px solid rgba(255,255,255,0.1); padding-bottom: env(safe-area-inset-bottom); } 
        }
    </style>
</head>
<body>
    <div id="app"></div>
    <script>
// DATA
const skillsCatalog = [
    {id:"stripe-integration",name:"Stripe Integration",category:"payments",risk:"medium"},
    {id:"nodejs-backend",name:"Node.js Backend",category:"engineering",risk:"low"},
    {id:"seo-audit",name:"SEO Audit",category:"marketing",risk:"low"},
    {id:"copywriting",name:"Copywriting",category:"marketing",risk:"low"},
    {id:"deployment",name:"Deployment",category:"ops",risk:"low"}
];

const routingRules = [
    {id:1,keyword:"stripe",priority:100,target:"Licensing"},
    {id:2,keyword:"payment",priority:100,target:"Licensing"},
    {id:3,keyword:"website",priority:90,target:"Client Services"},
    {id:4,keyword:"web app",priority:90,target:"Client Services"}
];

const agents = [
    {id:"0001",name:"Chief of Staff",type:"executive",status:"online"},
    {id:"0002-5",name:"Client Services",type:"business",status:"busy"},
    {id:"0002-6",name:"Licensing",type:"business",status:"online"},
    {id:"0003-1",name:"Growth Dept",type:"department",status:"online"}
];

let currentPage = 'dashboard';
let currentSettingsTab = 'skills';
let tasks = [];
try {
    const stored = localStorage.getItem('kdashx_tasks');
    if (stored) tasks = JSON.parse(stored);
} catch(e) { tasks = []; }

// RENDER FUNCTIONS
function renderSidebar() {
    const items = [
        {id:'dashboard',icon:'fa-home',label:'Dashboard'},
        {id:'org',icon:'fa-network-wired',label:'Organization'},
        {id:'intent',icon:'fa-plus-circle',label:'Intent'},
        {id:'execution',icon:'fa-play-circle',label:'Execution'},
        {id:'settings',icon:'fa-cog',label:'Settings'}
    ];
    
    let navHtml = '';
    items.forEach(function(item) {
        const isActive = currentPage === item.id;
        const cls = isActive ? 'nav-item active' : 'nav-item text-slate-400';
        navHtml += '<button class="' + cls + '" data-page="' + item.id + '">';
        navHtml += '<i class="fas ' + item.icon + '" style="width:1.25rem"></i>';
        navHtml += '<span>' + item.label + '</span></button>';
    });
    
    let mobileNav = '';
    items.slice(0,5).forEach(function(item) {
        const isActive = currentPage === item.id;
        const cls = isActive ? 'text-blue-400' : 'text-slate-500';
        mobileNav += '<button class="flex flex-col items-center gap-1 p-2 rounded-lg ' + cls + '" data-page="' + item.id + '" style="background:none;border:none;">';
        mobileNav += '<i class="fas ' + item.icon + ' text-xl"></i>';
        mobileNav += '<span style="font-size:10px">' + item.label.split(' ')[0] + '</span></button>';
    });
    
    return '<aside class="desktop-sidebar glass-card" style="position:fixed;left:0;top:0;height:100%;width:16rem;z-index:50;">' +
        '<div class="p-4 border-b border-white/5"><div style="display:flex;align-items:center;gap:0.75rem;">' +
        '<div style="width:2.5rem;height:2.5rem;border-radius:0.75rem;background:linear-gradient(135deg,#3b82f6,#6366f1);display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:1.125rem;">K</div>' +
        '<div><h1 style="font-weight:600;color:white;margin:0;">K-DashX</h1><p style="font-size:0.75rem;color:#64748b;margin:0;">Command Center</p></div></div></div>' +
        '<nav class="p-4" style="display:flex;flex-direction:column;gap:0.25rem;">' + navHtml + '</nav></aside>' +
        '<nav class="bottom-nav justify-around items-center py-2 px-4">' + mobileNav + '</nav>';
}

function renderHeader() {
    return '<header style="position:fixed;top:0;right:0;left:0;height:4rem;z-index:40;" class="glass-card lg:left-64"><div style="height:100%;display:flex;align-items:center;justify-content:space-between;padding:0 1rem;">' +
        '<div style="display:flex;align-items:center;gap:1rem;"><span style="color:#4ade80;font-size:0.875rem;font-weight:500;"><i class="fas fa-circle" style="font-size:0.375rem;margin-right:0.5rem;"></i>Claude AI Active</span></div>' +
        '<button onclick="haltSystem()" style="padding:0.5rem 0.75rem;background:rgba(239,68,68,0.1);color:#f87171;border:1px solid rgba(239,68,68,0.3);border-radius:0.5rem;font-size:0.875rem;font-weight:500;">' +
        '<i class="fas fa-power-off" style="margin-right:0.5rem;"></i>Halt</button></div></header>';
}

function renderDashboard() {
    const executing = tasks.filter(function(t) { return t.status === 'executing'; }).length;
    const completed = tasks.filter(function(t) { return t.status === 'completed'; }).length;
    const pending = tasks.filter(function(t) { return t.status === 'submitted'; }).length;
    const isActive = currentPage === 'dashboard' ? 'active' : '';
    
    let tasksHtml = '<div class="p-4 text-center text-slate-500">No tasks yet. Submit one via Intent page.</div>';
    if (tasks.length > 0) {
        tasksHtml = tasks.slice(0,5).map(function(t) {
            return '<div class="p-4"><div style="display:flex;justify-content:space-between;align-items:center;gap:0.75rem;">' +
                '<p style="color:white;margin:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex:1;">' + t.intent.substring(0,50) + '</p>' +
                '<span style="font-size:0.75rem;padding:0.25rem 0.5rem;border-radius:9999px;background:rgba(255,255,255,0.1);flex-shrink:0;">' + t.status + '</span></div></div>';
        }).join('');
    }
    
    return '<div id="page-dashboard" class="page ' + isActive + '">' +
        '<h1 style="font-size:1.5rem;font-weight:700;color:white;margin-bottom:1.5rem;">Dashboard</h1>' +
        '<div style="display:grid;grid-template-columns:repeat(2,1fr);gap:1rem;margin-bottom:1.5rem;">' +
        '<div class="glass-card" style="padding:1rem;"><p style="font-size:0.875rem;color:#94a3b8;margin:0 0 0.25rem;">System</p><p style="font-size:1.25rem;font-weight:700;color:#4ade80;margin:0;">Online</p></div>' +
        '<div class="glass-card" style="padding:1rem;"><p style="font-size:0.875rem;color:#94a3b8;margin:0 0 0.25rem;">Active</p><p style="font-size:1.25rem;font-weight:700;color:#60a5fa;margin:0;">' + executing + '</p></div>' +
        '<div class="glass-card" style="padding:1rem;"><p style="font-size:0.875rem;color:#94a3b8;margin:0 0 0.25rem;">Completed</p><p style="font-size:1.25rem;font-weight:700;color:#34d399;margin:0;">' + completed + '</p></div>' +
        '<div class="glass-card" style="padding:1rem;"><p style="font-size:0.875rem;color:#94a3b8;margin:0 0 0.25rem;">Pending</p><p style="font-size:1.25rem;font-weight:700;color:#fbbf24;margin:0;">' + pending + '</p></div>' +
        '</div>' +
        '<div class="glass-card"><div style="padding:1rem;border-bottom:1px solid rgba(255,255,255,0.05);"><h2 style="font-size:1.125rem;font-weight:600;color:white;margin:0;">Recent Tasks</h2></div>' +
        '<div style="border-top:1px solid rgba(255,255,255,0.05);">' + tasksHtml + '</div></div></div>';
}

function renderOrg() {
    const isActive = currentPage === 'org' ? 'active' : '';
    const agentsHtml = agents.map(function(a) {
        const statusColor = a.status === 'online' ? '#4ade80' : '#fbbf24';
        return '<div style="padding:0.75rem;display:flex;align-items:center;gap:0.75rem;">' +
            '<i class="fas fa-user" style="color:#60a5fa;"></i>' +
            '<span style="color:white;">' + a.name + '</span>' +
            '<span style="font-size:0.75rem;color:' + statusColor + '">' + a.status + '</span></div>';
    }).join('');
    
    return '<div id="page-org" class="page ' + isActive + '">' +
        '<h1 style="font-size:1.5rem;font-weight:700;color:white;margin-bottom:1.5rem;">Organization</h1>' +
        '<div class="glass-card" style="padding:1rem;">' + agentsHtml + '</div></div>';
}

function renderIntent() {
    const isActive = currentPage === 'intent' ? 'active' : '';
    return '<div id="page-intent" class="page ' + isActive + '">' +
        '<h1 style="font-size:1.5rem;font-weight:700;color:white;margin-bottom:1.5rem;">Submit Task</h1>' +
        '<div style="max-width:42rem;"><form onsubmit="submitTask(event)" class="glass-card" style="padding:1.5rem;">' +
        '<textarea id="intentInput" placeholder="What do you want to build?" style="height:8rem;margin-bottom:1rem;" required></textarea>' +
        '<button type="submit" style="width:100%;padding:0.75rem;background:linear-gradient(135deg,#3b82f6,#6366f1);color:white;border-radius:0.5rem;font-weight:500;">' +
        '<i class="fas fa-paper-plane" style="margin-right:0.5rem;"></i>Submit to Claude AI</button></form></div></div>';
}

function renderExecution() {
    const isActive = currentPage === 'execution' ? 'active' : '';
    let tasksHtml = '<div style="padding:2rem;text-align:center;color:#64748b;"><i class="fas fa-folder-open" style="font-size:2.25rem;margin-bottom:0.75rem;display:block;"></i>No tasks submitted yet.</div>';
    if (tasks.length > 0) {
        tasksHtml = tasks.map(function(t) {
            return '<div style="padding:1rem;"><p style="color:white;font-weight:500;margin:0;">' + t.intent.substring(0,60) + '</p>' +
                '<div style="display:flex;align-items:center;gap:0.5rem;margin-top:0.5rem;">' +
                '<span style="font-size:0.75rem;padding:0.25rem 0.5rem;border-radius:9999px;background:rgba(255,255,255,0.1);color:#cbd5e1;">' + t.status + '</span>' +
                '<span style="font-size:0.75rem;color:#64748b;">' + new Date(t.submitted_at).toLocaleString() + '</span></div></div>';
        }).join('');
    }
    
    return '<div id="page-execution" class="page ' + isActive + '">' +
        '<h1 style="font-size:1.5rem;font-weight:700;color:white;margin-bottom:1.5rem;">Execution</h1>' +
        '<div class="glass-card"><div style="padding:1rem;border-bottom:1px solid rgba(255,255,255,0.05);"><h2 style="font-size:1.125rem;font-weight:600;color:white;margin:0;">Tasks</h2></div>' +
        '<div>' + tasksHtml + '</div></div></div>';
}

function renderSettings() {
    const isActive = currentPage === 'settings' ? 'active' : '';
    const skillsBtnClass = currentSettingsTab === 'skills' ? 'tab-btn active' : 'tab-btn';
    const routingBtnClass = currentSettingsTab === 'routing' ? 'tab-btn active' : 'tab-btn';
    
    let contentHtml = '';
    if (currentSettingsTab === 'skills') {
        contentHtml = '<div style="display:grid;grid-template-columns:repeat(1,1fr);gap:0.75rem;">' + skillsCatalog.map(function(s) {
            const riskClass = s.risk === 'medium' ? 'background:rgba(251,191,36,0.2);color:#fbbf24;' : 'background:rgba(74,222,128,0.2);color:#4ade80;';
            return '<div style="padding:0.75rem;background:rgba(255,255,255,0.05);border-radius:0.5rem;">' +
                '<div style="display:flex;justify-content:space-between;margin-bottom:0.25rem;">' +
                '<span style="color:white;font-weight:500;">' + s.name + '</span>' +
                '<span style="font-size:0.75rem;padding:0.25rem 0.5rem;border-radius:9999px;' + riskClass + '">' + s.risk + '</span></div>' +
                '<span style="font-size:0.75rem;color:#94a3b8;">' + s.category + '</span></div>';
        }).join('') + '</div>';
    } else {
        contentHtml = '<div style="display:flex;flex-direction:column;gap:0.5rem;">' + routingRules.map(function(r) {
            return '<div style="display:flex;align-items:center;justify-content:space-between;padding:0.75rem;background:rgba(255,255,255,0.05);border-radius:0.5rem;">' +
                '<span style="padding:0.25rem 0.5rem;background:rgba(168,85,247,0.2);color:#a855f7;border-radius:0.25rem;font-size:0.75rem;font-weight:500;">' + r.keyword + '</span>' +
                '<i class="fas fa-arrow-right" style="color:#64748b;"></i>' +
                '<span style="color:white;">' + r.target + '</span>' +
                '<span style="font-size:0.75rem;color:#94a3b8;">P' + r.priority + '</span></div>';
        }).join('') + '</div>';
    }
    
    return '<div id="page-settings" class="page ' + isActive + '">' +
        '<h1 style="font-size:1.5rem;font-weight:700;color:white;margin-bottom:1.5rem;">Settings</h1>' +
        '<div style="display:flex;gap:0.5rem;margin-bottom:1.5rem;">' +
        '<button onclick="setTabSkills()" class="' + skillsBtnClass + '">Skills (' + skillsCatalog.length + ')</button>' +
        '<button onclick="setTabRouting()" class="' + routingBtnClass + '">Routing (' + routingRules.length + ')</button>' +
        '</div>' +
        '<div class="glass-card" style="padding:1.5rem;">' + contentHtml + '</div></div>';
}

function renderApp() {
    return renderSidebar() + renderHeader() + '<main style="margin-left:0;padding-top:5rem;padding-left:1rem;padding-right:1rem;min-height:100vh;padding-bottom:5rem;" class="lg:ml-64">' + 
        renderDashboard() + renderOrg() + renderIntent() + renderExecution() + renderSettings() + '</main>';
}

// NAVIGATION
function navigate(pageName) {
    currentPage = pageName;
    document.querySelectorAll('.page').forEach(function(p) { p.classList.remove('active'); });
    var pageEl = document.getElementById('page-' + currentPage);
    if (pageEl) pageEl.classList.add('active');
    render();
}

function setTabSkills() {
    currentSettingsTab = 'skills';
    render();
}

function setTabRouting() {
    currentSettingsTab = 'routing';
    render();
}

function render() {
    document.getElementById('app').innerHTML = renderApp();
    attachEventListeners();
}

function attachEventListeners() {
    // Attach click handlers to sidebar buttons
    document.querySelectorAll('[data-page]').forEach(function(btn) {
        btn.addEventListener('click', function() {
            navigate(btn.dataset.page);
        });
    });
}

// TASK FUNCTIONS
function submitTask(e) {
    e.preventDefault();
    var intent = document.getElementById('intentInput').value.trim();
    if (!intent) return;
    
    var task = {
        id: 'task-' + Date.now(),
        intent: intent,
        status: 'submitted',
        assigned_agent: routeIntent(intent),
        routing_method: 'keyword',
        submitted_at: new Date().toISOString()
    };
    
    tasks.unshift(task);
    try {
        localStorage.setItem('kdashx_tasks', JSON.stringify(tasks));
    } catch(e) {}
    
    document.getElementById('intentInput').value = '';
    alert('Task submitted: ' + intent);
    navigate('execution');
}

function routeIntent(intent) {
    var lower = intent.toLowerCase();
    if (lower.indexOf('stripe') !== -1 || lower.indexOf('payment') !== -1) return 'Licensing';
    if (lower.indexOf('seo') !== -1 || lower.indexOf('copy') !== -1 || lower.indexOf('marketing') !== -1) return 'Growth Dept';
    return 'Client Services';
}

function haltSystem() {
    if (confirm('Halt all systems?')) alert('System halted');
}

// INITIAL RENDER
document.getElementById('app').innerHTML = renderApp();
attachEventListeners();
</script></body></html>
